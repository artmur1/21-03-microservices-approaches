# Домашнее задание к занятию «Микросервисы: подходы» - `Мурчин Артем`

Вы работаете в крупной компании, которая строит систему на основе микросервисной архитектуры.
Вам как DevOps-специалисту необходимо выдвинуть предложение по организации инфраструктуры для разработки и эксплуатации.


## Задача 1: Обеспечить разработку

Предложите решение для обеспечения процесса разработки: хранение исходного кода, непрерывная интеграция и непрерывная поставка. 
Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия.

Решение должно соответствовать следующим требованиям:
- облачная система;
- система контроля версий Git;
- репозиторий на каждый сервис;
- запуск сборки по событию из системы контроля версий;
- запуск сборки по кнопке с указанием параметров;
- возможность привязать настройки к каждой сборке;
- возможность создания шаблонов для различных конфигураций сборок;
- возможность безопасного хранения секретных данных (пароли, ключи доступа);
- несколько конфигураций для сборки из одного репозитория;
- кастомные шаги при сборке;
- собственные докер-образы для сборки проектов;
- возможность развернуть агентов сборки на собственных серверах;
- возможность параллельного запуска нескольких сборок;
- возможность параллельного запуска тестов.

Обоснуйте свой выбор.

## Решение 1

Покапавшись в интернете, нашел ряд инструментов разработки программного обеспечения и программирования.

### 1. GitHub

Это платформа, которая в основном предназначена для групп разработчиков программного обеспечения для совместной разработки. Он поддерживает как проверку кода, так и управление им благодаря своим расширенным функциям. Более 56 миллионов разработчиков и более 3 миллионов компаний используют этот известный инструмент разработки программного обеспечения. Они предоставляют услуги нескольким известным компаниям, включая Adobe, Dell Technologies и Ford.

Поэтому GitHub, безусловно, является самым популярным инструментом разработки программного обеспечения. Огромная популярность GitHub обусловлена ​​тем, что он действует как веб-служба хостинга репозиториев Git, аналогичная Google Drive. Вы можете загрузить свою работу на веб-сайт (публично или конфиденциально), чтобы обеспечить ее безопасность или поделиться ею с другими. Несколько разработчиков программного обеспечения, расположенные в любой точке мира, могут легко работать над одним проектом. Если вы ищете место для совместной работы над проектом с кем-то еще, это отличное место.

### 2. Chrome DevTools

Chrome DevTools предназначен для веб-разработчиков для написания веб-приложений, веб-сервисов и тестирования. Различные инструменты отладки встроены прямо в браузер Google Chrome для облегчения веб-разработки. Chrome DevTools — один из лучших инструментов разработки программного обеспечения для разработчиков веб-сайтов, поскольку он разработан непосредственно Google.

Вы можете протестировать CSS на страницах своего веб-сайта, отладить Javascript в браузере и оценить, насколько хорошо ваше приложение работает во внешнем интерфейсе, благодаря DevTools. С помощью Chrome DevTools вы можете легко изучать и изменять DOM, оценивать ресурсы, нагрузку и эффективность веб-сайта, учитывать потребление памяти страницы и многое другое. Любой, кто работает в онлайн-индустрии, должен иметь доступ к этой технологии. Одним из наиболее важных аспектов Google DevTools является то, что они доступны бесплатно через браузер Chrome.

### 3. Azure

Azure — это инструмент разработки программного обеспечения Microsoft, который часто используется для создания, тестирования, развертывания и управления облачными приложениями на всех платформах. Azure поддерживает большое количество приложений и языков программирования и предоставляет как общедоступные, так и частные облака.

Гибридные возможности Azure — одна из ее основных особенностей. Организации могут использовать Azure в качестве автономной общедоступной облачной службы или расширять существующую локальную инфраструктуру в облако. Через Azure доступен широкий спектр других возможностей и услуг, в том числе связанных с вычислениями, хранилищем, сетями, базами данных, кибербезопасностью и многочисленными расширенными функциями с помощью искусственного интеллекта.

С помощью инструментов DevOps Microsoft Azure позволяет разработчикам быстро создавать надежные приложения. Он обновляет текущие программы, используя бессерверные технологии и контейнеры. Кроме того, он поддерживает различное оборудование, среды программирования и языки программирования.

### 4. Visual Studio Code

Visual Studio Code — один из самых популярных редакторов кода среди разработчиков программного обеспечения. Его обычно называют VS Code. Он доступен для всех основных операционных систем, поскольку эту платформу разработки программного обеспечения используют многие опытные и начинающие разработчики программного обеспечения.

Это мощный редактор кода с открытым исходным кодом, который включает в себя все основные функции, которые можно ожидать от лучшего инструмента разработки программного обеспечения. Он включает в себя интегрированный CLI, возможность выделения синтаксиса, функции отступов, проверку кода и компиляцию кода.

Вы можете легко настроить VS Code с помощью плагинов, доступных на Marketplace. Он интегрируется с Git и предлагает отличный пользовательский интерфейс. Инструмент поддерживает различные языки программирования и среды программирования. Обширный встроенный доступ к терминалу VSCode делает его универсальным инструментом разработки.

### 5. Docker

Docker — это среда программирования, которая используется для создания приложений, работающих в контейнерах. Проще говоря, контейнер — это небольшая среда выполнения, которая использует общее ядро, но работает независимо. Открытый исходный код этой технологии привел к значительной популярности Docker как надежного инструмента разработки программного обеспечения.

### 6. GitLab

Когда вы слышите термин GitLab, велика вероятность, что вы спутаете его с GitHub. И GitLab, и GitHub являются системами контроля версий. Однако между этими услугами по разработке программного обеспечения есть некоторые существенные различия.

GitHub — это, главным образом, инструмент для совместной работы, который фокусируется на удаленной проверке кода и управлении кодом. Однако GitLab — это платформа, ориентированная на DevOps и Cl/CD для тщательного планирования проектов, управления исходным кодом и мониторинга проектов. Она призвана стать единственной платформой, необходимой на протяжении всего жизненного цикла DevOps .

С GitLab вы можете управлять и оптимизировать процедуры доставки программного обеспечения, а также правильно планировать весь процесс развертывания. Более того, вы также можете создавать код и управлять им через дружественный пользовательский интерфейс. Другие функции, такие как автоматическое тестирование и быстрые отчеты, также делают GitLab очень популярным инструментом разработки программного обеспечения.

Что касается цен, вы можете получить бесплатный план GitLab с ограниченными функциями. Однако, если вам нужны дополнительные функции, вы можете купить план Starter за 4 доллара США , план Premium за 19 долларов США или план Ultimate за 99 долларов США за пользователя в месяц.

### Вывод

В качестве решения для обеспечения процесса разработки предпочительнее будет выбрать GitLab. Данный инструмент соответствует большинству предоставленных требований. Для хранения секретных данных можно подключить внешнее хранилище Hashicorp Vault.

## Задача 2: Логи

Предложите решение для обеспечения сбора и анализа логов сервисов в микросервисной архитектуре.
Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия.

Решение должно соответствовать следующим требованиям:
- сбор логов в центральное хранилище со всех хостов, обслуживающих систему;
- минимальные требования к приложениям, сбор логов из stdout;
- гарантированная доставка логов до центрального хранилища;
- обеспечение поиска и фильтрации по записям логов;
- обеспечение пользовательского интерфейса с возможностью предоставления доступа разработчикам для поиска по записям логов;
- возможность дать ссылку на сохранённый поиск по записям логов.

Обоснуйте свой выбор.

## Решение 2

Есть коммерческие и облачные решения для агрегации и анализа журналов — Loggly, Splunk, Logentries и другие. Из open source решений очень популярен стек ELK от Elasticsearch, Logstash, Kibana. В основе ELK лежит построенный на базе библиотеки Apache Lucene поисковый движок Elasticsearch для индексирования и поиска информации в любом типе документов. Для сбора журналов из многочисленных источников и централизованного хранения используется Logstash, который поддерживает множество входных типов данных — это могут быть журналы, метрики разных сервисов и служб. При получении он их структурирует, фильтрует, анализирует, идентифицирует информацию (например, геокоординаты IP-адреса), упрощая тем самым последующий анализ. В дальнейшем нас интересует его работа в связке с Elasticsearch, хотя для Logstash написано большое количество расширений, позволяющих настроить вывод информации практически в любой другой источник.

И наконец, Kibana — это веб-интерфейс для вывода индексированных Elasticsearch логов. Результатом может быть не только текстовая информация, но и, что удобно, диаграммы и графики. Он может визуализировать геоданные, строить отчеты, при установке X-Pack становятся доступными алерты. Здесь уже каждый подстраивает интерфейс под свои задачи. Все продукты выпускаются одной компанией, поэтому их развертывание и совместная работа не представляет проблем, нужно только все правильно соединить.

В зависимости от инфраструктуры в ELK могут участвовать и другие приложения. Так, для передачи логов приложений с серверов на Logstash мы будем использовать Filebeat. Кроме этого, также доступны Winlogbeat (события Windows Event Logs), Metricbeat (метрики), Packetbeat (сетевая информация) и Heartbeat (uptime).

ELK соответствует заявленным в задании требованиям.

## Задача 3: Мониторинг

Предложите решение для обеспечения сбора и анализа состояния хостов и сервисов в микросервисной архитектуре.
Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия.

Решение должно соответствовать следующим требованиям:
- сбор метрик со всех хостов, обслуживающих систему;
- сбор метрик состояния ресурсов хостов: CPU, RAM, HDD, Network;
- сбор метрик потребляемых ресурсов для каждого сервиса: CPU, RAM, HDD, Network;
- сбор метрик, специфичных для каждого сервиса;
- пользовательский интерфейс с возможностью делать запросы и агрегировать информацию;
- пользовательский интерфейс с возможностью настраивать различные панели для отслеживания состояния системы.

Обоснуйте свой выбор.

## Решение 3

Для обеспечения сбора и анализа состояния хостов и сервисов в микросервисной архитектуре можно использовать Grafana и Prometheus.

Grafana и Prometheus образуют вместе систему мониторинга, которая позволяет работать со статистикой и оперативно отслеживать изменения в инфраструктуре.

Grafana — это гибкая система визуализации данных с web-интерфейсом, которая работает с десятками разнообразных баз данных: начиная от классических SQL-баз данных, заканчивая базами данных временных рядов.

Prometheus — это СУБД хранения временных рядов с возможностью построения графиков, настройки оповещений и работы с БД через язык запросов PromQL.

Prometheus в отличие от других СУБД сам опрашивает хосты и забирает из них данные. Программы, которые снимают данные с хостов, называются экспортёрами. Самый востребованный из них — node exporter.

## Задача 4: Логи * (необязательная)

Продолжить работу по задаче API Gateway: сервисы, используемые в задаче, пишут логи в stdout. 

Добавить в систему сервисы для сбора логов Vector + ElasticSearch + Kibana со всех сервисов, обеспечивающих работу API.

### Результат выполнения: 

docker compose файл, запустив который можно перейти по адресу http://localhost:8081, по которому доступна Kibana.
Логин в Kibana должен быть admin, пароль qwerty123456.


## Задача 5: Мониторинг * (необязательная)

Продолжить работу по задаче API Gateway: сервисы, используемые в задаче, предоставляют набор метрик в формате prometheus:

- сервис security по адресу /metrics,
- сервис uploader по адресу /metrics,
- сервис storage (minio) по адресу /minio/v2/metrics/cluster.

Добавить в систему сервисы для сбора метрик (Prometheus и Grafana) со всех сервисов, обеспечивающих работу API.
Построить в Graphana dashboard, показывающий распределение запросов по сервисам.

### Результат выполнения: 

docker compose файл, запустив который можно перейти по адресу http://localhost:8081, по которому доступна Grafana с настроенным Dashboard.
Логин в Grafana должен быть admin, пароль qwerty123456.

---

### Как оформить ДЗ?

Выполненное домашнее задание пришлите ссылкой на .md-файл в вашем репозитории.

---
